## lambda-arc-events-filter
Filters ARC kinesis feed events

## deployment

1) Creating the Zip file for the code and push it on s3 - 
The below command will create the zip file and will push it to the aws S3 bucket.
Note* -  it requires the S3 AWS credentials to be 

`docker build -t arc-cms-filter:0.1 --build-arg bucket=[S3_Bucket] --build-arg file_name=ArcCms_Kinesis_feed_filter.zip --build-arg auto_deploy=true .`

where - 
S3_Bucket = S3 bucket name
file_name = Lambda code zip Filename to be uploaded on S3
auto_deploy = true if to ship the zip to S3

2) Deploying the Lambda function -

**2.1) Using AWS CLI -** 
```
aws lambda create-function --function-name ArcFilterFunction --runtime python3.8 --role admin --handler app.execute --zip-file fileb://deployment.zip  --role "[lambda-kinesis-access-roles]"

aws lambda create-event-source-mapping --function-name ArcFilterFunction \
--event-source  [stream-arn] \
--batch-size 1 --starting-position LATEST

aws lambda update-function-configuration --function-name ArcFilterFunction \
--environment "Variables={TO_FILTER_PARAMETERS=operation, OUTPUT_STREAM=filtered_cmsfeed}"
```

if any code is changed - 
```
awslocal lambda update-function-code --function-name ArcFilterFunction --zip-file fileb://deployment.zip
```

**2.2) Using AWS UI -** 

1) Click on the "**create function**" button on the aws lambda page.

2) Enter the below details in next page - 

`Function Name` : ArcFilterFunction
`Runtime` : Python3.8 

3) Choose or **create an execution role**
Choose `Create a new role from AWS policy templates`
that has the role with basic Lambda permission and Please ensure the role can perform the GetRecords, 
GetShardIterator, DescribeStream, and ListStreams Actions on your stream in IAM.

and click on create function

4) Add Trigger
click on Add Trigger button and **choose Kinesis**

Now Trigger Configuration
**Kinesis stream** - Select a Kinesis stream to listen for updates on.
**Starting position** -  Latest


5) Under the Function code you will find the sample code present. Now we have to add the zip uploaded to S3 running
the docker file as mentioned in **the 1st Step**. 

click on Action and choose 'Upload a file from Amazon S3' and enter the path where the zip file is uploaded.

6) Set up the Environment variables - 

Click on Manage environment variables -> add environment variable
and add at least these variables -
Key                             value
**TO_FILTER_PARAMETERS**        operations
**OUTPUT_STREAM**               filtered_stream

and click on save.

7) Now hover to Basic Setting tab and click on Edit and change the handler to

**app.execute** from lambda_function.lambda_handler

Done and the lambda function is create and active.

**To Test**
GO on top and Select a test event from the drop down menu and click configure test event

Select `Create new test event`
enter `Event template` as hello-world
and `Event name` as testEvent
and paste the below sample arc kinesis json formatted event

```
{
    "Records": [
        {
            "eventID": "shardId-000000000000:49609560339806358283862413364490677014111167574043525122",
            "eventSourceARN": "arn:aws:kinesis:us-east-1:781427261571:stream/sample_arc_cms_stream",
            "kinesis": {
                "sequenceNumber": "49609560339806358283862413364485841310832665970232786946",
                "approximateArrivalTimestamp": 1596660975.658,
                "data": "ewogICJ0eXBlIjogImNvbnRlbnQtb3BlcmF0aW9uIiwKICAib3BlcmF0aW9uIjogImRlbGV0ZS1zdG9yeSIsCiAgImRhdGUiOiAiMjAyMC0wNy0yNFQwMjowNDozNi40NDUrMDA6MDAiLAogICJkYXRlX21zIjogIjIwMjAtMDctMjRUMDI6MDQ6MzYuNDQ1KzAwOjAwIiwKICAib3JnYW5pemF0aW9uX2lkIjogInNhbmRib3gudGdhbSIsCiAgImlkIjogIldSTEpVVlI1VkZQRFpLUFFaUE9YS1JZQzRZIiwKICAiYnJhbmNoIjogImRlZmF1bHQiLAogICJwdWJsaXNoZWQiOiBmYWxzZSwKICAiYm9keSI6IHsKICAgICJ0eXBlIjogInN0b3J5IiwKICAgICJ2ZXJzaW9uIjogIjAuMTAuNSIsCiAgICAiY29udGVudF9lbGVtZW50cyI6IFsKICAgICAgewogICAgICAgICJfaWQiOiAiQVhZN1pJUUsySkpYTEY2NUNQTlBGVk5LTlUiLAogICAgICAgICJ0eXBlIjogImltYWdlIiwKICAgICAgICAidmVyc2lvbiI6ICIwLjEwLjUiLAogICAgICAgICJjcmVkaXRzIjoge30sCiAgICAgICAgIndpZHRoIjogMTI4MCwKICAgICAgICAiY2FwdGlvbiI6ICJCaWxsIEJyeWFuLCBoZWFkIG9mIHNjaWVuY2UgYW5kIHRlY2hub2xvZ3kgYXQgdGhlIERlcGFydG1lbnQgb2YgSG9tZWxhbmQgU2VjdXJpdHksIHNwZWFrcyBhYm91dCB0aGUgY29yb25hdmlydXMgaW4gdGhlIEphbWVzIEJyYWR5IFByZXNzIEJyaWVmaW5nIFJvb20gb2YgdGhlIFdoaXRlIEhvdXNlLCBUaHVyc2RheSwgQXByaWwgMjMsIDIwMjAsIGluIFdhc2hpbmd0b24uIChBUCBQaG90by9BbGV4IEJyYW5kb24pIiwKICAgICAgICAiYWRkaXRpb25hbF9wcm9wZXJ0aWVzIjogewogICAgICAgICAgInNvdXJjZV91cmwiOiAiRENBQjMyMy00MjNfMjAyMF8yMjA4MjkuanBnIgogICAgICAgIH0sCiAgICAgICAgInNvdXJjZSI6IHsKICAgICAgICAgICJuYW1lIjogIlRoZSBBc3NvY2lhdGVkIFByZXNzIiwKICAgICAgICAgICJzb3VyY2VfaWQiOiAiY3Bfbml0Zi9Xb3JsZC9EQ0FCMzIzLTQyM18yMDIwXzIyMDgyOS5qcGciLAogICAgICAgICAgInNvdXJjZV90eXBlIjogIldpcmUiLAogICAgICAgICAgImFkZGl0aW9uYWxfcHJvcGVydGllcyI6IHsKICAgICAgICAgICAgImVkaXRvciI6ICJwaG90byBjZW50ZXIiCiAgICAgICAgICB9LAogICAgICAgICAgInN5c3RlbSI6ICJhcmMgaS9vIgogICAgICAgIH0sCiAgICAgICAgImRpc3RyaWJ1dG9yIjogewogICAgICAgICAgInJlZmVyZW5jZV9pZCI6ICI5Y2E1OTY3MS1iZjE2LTRjYmQtODZmMC04MTNmYjYwYWJiMjQiLAogICAgICAgICAgIm1vZGUiOiAicmVmZXJlbmNlIgogICAgICAgIH0sCiAgICAgICAgInVybCI6ICJodHRwczovL2Nsb3VkZnJvbnQtdXMtZWFzdC0xLmltYWdlcy5hcmNwdWJsaXNoaW5nLmNvbS9zYW5kYm94LnRnYW0vQVhZN1pJUUsySkpYTEY2NUNQTlBGVk5LTlUuanBnIiwKICAgICAgICAiaGVpZ2h0IjogODUzCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIkhIQkM3TkJNNUZESTVNUVlRNUxDUFNLQUFVIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJXQVNISU5HVE9OIC0gVGhlIHNlbmlvciBEZXBhcnRtZW50IG9mIEhvbWVsYW5kIFNlY3VyaXR5IG9mZmljaWFsIHdobyB3YXMgdGhydXN0IGludG8gdGhlIHNwb3RsaWdodCBieSBQcmVzaWRlbnQgRG9uYWxkIFRydW1wIHRvIGRlc2NyaWJlIHRoZSBlZmZlY3RzIG9mIHRlbXBlcmF0dXJlIG9uIENPVklELTE5IGhhcyBiZWVuIHRoZSBzdWJqZWN0IG9mIG1pc2NvbmR1Y3QgYWxsZWdhdGlvbnMgZm9yIGhpcyBwcmV2aW91cyBnb3Zlcm5tZW50IHdvcmsuIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICJESFlPUkJCMllWQ0tWTlk1VTZQSFhHTEhWNCIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiQSBEZXBhcnRtZW50IG9mIEVuZXJneSBJbnNwZWN0b3IgR2VuZXJhbCBpbnZlc3RpZ2F0aW9uIHdhcyBzdGlsbCBwZW5kaW5nIEZyaWRheSBiYXNlZCBvbiBldmlkZW5jZSBzdWJtaXR0ZWQgYnkgYSB3aGlzdGxlLWJsb3dlciB0aGF0IFdpbGxpYW0gQnJ5YW4gYWJ1c2VkIGhpcyBnb3Zlcm5tZW50IHBvc2l0aW9uIHdpdGggZW5lcmd5IGNvbnN1bHRpbmcgd29yayBpbiBVa3JhaW5lLiIKICAgICAgfSwKICAgICAgewogICAgICAgICJfaWQiOiAiSlA0WUJRVjI3UkdSWE03N0lSN01HSTZIUVEiLAogICAgICAgICJ0eXBlIjogInRleHQiLAogICAgICAgICJjb250ZW50IjogIkl04oCZcyB1bmNsZWFyIGlmIFRydW1wIHdhcyBhd2FyZSBvZiB0aGF0IGludmVzdGlnYXRpb24gd2hlbiBoZSBjYWxsZWQgb24gQnJ5YW4gYXQgaGlzIGRhaWx5IGJyaWVmaW5nIFRodXJzZGF5IHRvIGV4cGxhaW4gREhTIHJlc2VhcmNoIHRoYXQgcHJvbXB0ZWQgYSBwcmVzaWRlbnRpYWwgcmlmZiBvbiB0aGUgcG90ZW50aWFsIHRvIGN1cmUgdGhlIHZpcnVzIHdpdGggZGlzaW5mZWN0YW50IGFuZCBraWxsIGl0IHdpdGggc3VubGlnaHQuIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICJRTEJCNVVNQUhSSE01SDdHUUtBSkdJRVNaNCIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiQnJ5YW4gaGFzIGJlZW4gYWN0aW5nIHVuZGVyc2VjcmV0YXJ5IGZvciB0aGUgREhTIFNjaWVuY2UgYW5kIFRlY2hub2xvZ3kgRGlyZWN0b3JhdGUsIHNpbmNlIE1heSAyMDE3LiBCZWZvcmUgdGhhdCwgaGUgd2FzIHByZXNpZGVudCBvZiBWYWx1ZUJyaWRnZSBJbnRlcm5hdGlvbmFs4oCZcyBFbmVyZ3kgR3JvdXAsIGEgY29uc3VsdGluZyBmaXJtIGluIFZpcmdpbmlhLCBmb2xsb3dpbmcgcHJldmlvdXMgd29yayB3aXRoIHRoZSBEZXBhcnRtZW50IG9mIEVuZXJneS4iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIkdYNDdXSExaNVZDR0xNWk5JWFdDV0VOWExNIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJUcnVtcCBub21pbmF0ZWQgaGltIHRvIGJlIHRoZSB1bmRlcnNlY3JldGFyeSBvZiB0aGUgZGlyZWN0b3JhdGUsIHdoaWNoIGlzIGNoYXJnZWQgd2l0aCBkZXZlbG9waW5nIHRlY2hub2xvZ3kgZm9yIHRoZSBjb21wb25lbnRzIG9mIERIUy4gQnV0IGRheXMgYWZ0ZXIgaGlzIFNlbmF0ZSBoZWFyaW5nIGluIEF1Z3VzdCwgYSBnb3Zlcm5tZW50IHdoaXN0bGUtYmxvd2VyIGFuZCBoaXMgYXR0b3JuZXlzIHJlY2VpdmVkIGEgbGV0dGVyIGZyb20gdGhlIE9mZmljZSBvZiB0aGUgU3BlY2lhbCBDb3Vuc2VsIHRoYXQgaW5mb3JtYXRpb24gdGhleSBwcm92aWRlZCBhYm91dCBCcnlhbiBzaG93ZWQgYSDigJxzdWJzdGFudGlhbCBsaWtlbGlob29kIG9mIHdyb25nZG9pbmcu4oCdIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICJZUTVTSzIzU0NWQ1lOTEdZNEtHUVNBWExBQSIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiVGhlIGxldHRlciwgZmlyc3QgcmVwb3J0ZWQgYnkgVGhlIEhpbGwgbmV3c3BhcGVyIGluIFNlcHRlbWJlciwgc2FpZCB0aGUgT2ZmaWNlIG9mIHRoZSBTcGVjaWFsIENvdW5zZWwsIGFuIGluZGVwZW5kZW50IGZlZGVyYWwgaW52ZXN0aWdhdGl2ZSBhZ2VuY3ksIGhhZCByZWZlcnJlZCB0aGUgbWF0dGVyIHRvIHRoZSBEZXBhcnRtZW50IG9mIEVuZXJneSBPZmZpY2Ugb2YgSW5zcGVjdG9yIEdlbmVyYWwsIHdoaWNoIG9wZW5lZCBhbiBpbnZlc3RpZ2F0aW9uLiIKICAgICAgfSwKICAgICAgewogICAgICAgICJfaWQiOiAiQkRCWk40NjdJSkdOWkFZT1FaUDVPVEo2RkUiLAogICAgICAgICJ0eXBlIjogInRleHQiLAogICAgICAgICJjb250ZW50IjogIlRoZSBsZXR0ZXIsIGEgY29weSBvZiB3aGljaCB3YXMgb2J0YWluZWQgYnkgVGhlIEFzc29jaWF0ZWQgUHJlc3MsIHNhaWQgdGhlIElHIHdvdWxkIGNvbmR1Y3QgYW4gaW52ZXN0aWdhdGlvbiB0byBzZWUgaWYgaGlzIGFsbGVnYXRpb25zIGNvdWxkIGJlIHN1YnN0YW50aWF0ZWQgYW5kIHdvdWxkIGluZm9ybSBDb25ncmVzcyBhbmQgdGhlIHByZXNpZGVudC4iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIkxWTVpQVkdITkpDQUROU0MzMkdBWklMM1RBIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJUaGUgYWxsZWdhdGlvbnMgYWdhaW5zdCBCcnlhbiwgd2hpY2ggd2VyZSByZXBvcnRlZCBieSBUaGUgTmV3IFlvcmsgVGltZXMgaW4gT2N0b2JlciAyMDE4LCBjZW50cmUgYXJvdW5kIGhpcyB0aW1lIGFzIGEgc2VuaW9yIGFkdmlzZXIgaW4gdGhlIE9mZmljZSBvZiBJbnRlcm5hdGlvbmFsIEFmZmFpcnMgaW4gMjAxNi4gSGUgd2FzIGRlc2lnbmF0ZWQgYSDigJxzcGVjaWFsIGdvdmVybm1lbnQgZW1wbG95ZWUs4oCdIHdoaWNoIGFsbG93ZWQgaGltIHRvIGRvIGxpbWl0ZWQgcHJpdmF0ZSBzZWN0b3Igd29yay4iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIlI0V0NGR0dJU1ZCNTVJWE42Tk5DQ1IyVjRFIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJUaGUgd2hpc3RsZS1ibG93ZXIsIFJvYmVydCBJdnksIGFsbGVnZWQgdGhhdCBCcnlhbiB1c2VkIGhpcyBET0UgcG9zaXRpb24gdG8gZGV2ZWxvcCBoaXMgYnVzaW5lc3MgaW50ZXJlc3RzIHdpdGggVmFsdWVCcmlkZ2UsIGluY2x1ZGluZyBieSBwcm92aWRpbmcgbW9uZXkgdG8gZm9yZWlnbiBvZmZpY2lhbHMgd2l0aCB0aGUgZ29hbCBvZiBpbmZsdWVuY2luZyB0aGVpciBhY3Rpb25zIGFuZCBpbXByb3Blcmx5IHNoYXJpbmcgcHJvcHJpZXRhcnkgaW5mb3JtYXRpb24uIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICJNV1dOUk5KVVdWRDVMS1BLNVZLSVk0Tk9URSIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiVGhlIGFsbGVnYXRpb25zIHJlZmVyZW5jZSBwbGF5ZXJzIHdobyBmZWF0dXJlZCBwcm9taW5lbnRseSBpbiBzcGVjaWFsIGNvdW5zZWwgUm9iZXJ0IE11ZWxsZXLigJlzIGludmVzdGlnYXRpb24gaW50byB0aWVzIGJldHdlZW4gUnVzc2lhIGFuZCB0aGUgVHJ1bXAgY2FtcGFpZ24uIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICJIM0hLWkZKNlBKRk5CRlVIN0lUT0dYM1lTNCIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiVGhlIGNvbXBsYWludCwgd2hpY2ggd2FzIGFsc28gb2J0YWluZWQgYnkgQVAsIGRlc2NyaWJlcyBCcnlhbuKAmXMgZGVhbGluZ3Mgd2l0aCBSaW5hdCBBa2htZXRvdiwgdGhlIFVrcmFpbmlhbiBlbmVyZ3kgb2xpZ2FyY2ggd2hvIGhpcmVkIFBhdWwgTWFuYWZvcnQgYXMgYW4gYWR2aXNlciB5ZWFycyBiZWZvcmUgTWFuYWZvcnQgYmVjYW1lIGNoYWlybWFuIG9mIFRydW1w4oCZcyBwcmVzaWRlbnRpYWwgY2FtcGFpZ24uIEFjY29yZGluZyB0byB0aGUgY29tcGxhaW50LCBCcnlhbiBkZW5pZWQgZXZlciBpbnRlcmFjdGluZyB3aXRoIE1hbmFmb3J0LCB3aG8gd2FzIGNvbnZpY3RlZCBpbiBNdWVsbGVy4oCZcyBSdXNzaWEgaW52ZXN0aWdhdGlvbiByZWxhdGVkIHRvIE1hbmFmb3J04oCZcyB3b3JrIGluIFVrcmFpbmUg4oCUIHRob3VnaCB0aGV5IGRpZCBzdGF5IGF0IHRoZSBzYW1lIEh5YXR0IEhvdGVsIGluIEt5aXYgb24gb25lIG9jY2FzaW9uIHJlY291bnRlZCBieSB0aGUgd2hpc3RsZS1ibG93ZXIuIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICI1NlJUSTJOUUFSQjVCSUVKVTM2NU1SWE1QNCIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiSXQgc2F5cyBCcnlhbiwgYXMgdGhlIGhlYWQgb2YgYW4gRW5lcmd5IERlcGFydG1lbnQgdGVhbSB0aGF0IHRyYXZlbGxlZCB0byBVa3JhaW5lIHdpdGggdGhlIGdvYWwgb2Ygc3RhYmlsaXppbmcgdGhlIGNvdW50cnnigJlzIGVuZXJneSBzZWN1cml0eSwgYWxpZ25lZCBoaW1zZWxmIHdpdGggQWhrbWV0b3YsIGJlY2FtZSDigJxlbnNuYXJlZCBpbiBVa3JhaW5l4oCZcyBoaWdoLXN0YWtlcyBwb3dlciByaXZhbHJpZXPigJ0gYW5kIGNhc2hlZCBpbiDigJxwZXJzb25hbGx5IG9uIHRoZSBjb3dib3kgY2FwaXRhbGlzbSB0aGF0IGhhcyBkcml2ZW4gc28gbXVjaCBvZiB0aGUgZm9ybWVyIFNvdmlldCBVbmlvbi7igJ0iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIlBWTlMyT000WVpETE5NREYzUktLSVo2R0FRIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJJdnksIGEgZm9ybWVyIERPRSBvZmZpY2lhbCB3aG8gbm93IHdvcmtzIGluIHRoZSBwcml2YXRlIHNlY3RvciwgYW5kIGhpcyBhdHRvcm5leSBzYWlkIEZyaWRheSB0aGF0IHRoZXkgcHJvdmlkZWQgaW5mb3JtYXRpb24gdG8gdGhlIElHIGludmVzdGlnYXRpb24gYnV0IGhhdmUgbm90IHJlY2VpdmVkIGFueSBub3RpY2Ugb2YgYSBjb25jbHVzaW9uLiBCb3RoIGV4cHJlc3NlZCBzdXJwcmlzZSB0aGF0IEJyeWFuLCB3aG8gaGFzIGEgbWlsaXRhcnkgYmFja2dyb3VuZCBidXQgaXMgbm90IGEgc2NpZW50aXN0LCB3YXMgY2FsbGVkIHVwb24gYnkgdGhlIFRydW1wIHRvIGRpc2N1c3MgdGhlIHJlc2VhcmNoLiIKICAgICAgfSwKICAgICAgewogICAgICAgICJfaWQiOiAiQjc3UlRMTkdNWkFWWkRHUE0zWVhLMlg2TEEiLAogICAgICAgICJ0eXBlIjogInRleHQiLAogICAgICAgICJjb250ZW50IjogIuKAnEJpbGwgQnJ5YW4gc2hvdWxkIG5vdCBiZSBpbiB0aGF0IHBvc2l0aW9uIGluIHRoZSBmaXJzdCBwbGFjZSzigJ0gc2FpZCBKb2huIFR5ZSwgSXZ54oCZcyBhdHRvcm5leSBhbmQgdGhlIGZvdW5kZXIgYW5kIENFTyBvZiBXaGlzdGxlYmxvd2VyIEFpZC4g4oCcVGhlIFUuUy4gZ292ZXJubWVudCBmb3VuZCBhIHN1YnN0YW50aWFsIGxpa2VsaWhvb2Qgb2Ygd3Jvbmdkb2luZyBieSBoaW0gb24gYm90aCB0aGUgY29ycnVwdGlvbiBhbmQgc2VjdXJpdHkgdmlvbGF0aW9uIG1hdHRlcnMu4oCdIgogICAgICB9LAogICAgICB7CiAgICAgICAgIl9pZCI6ICI1N1hHUlJaQzRaRENMSzI0R0FKUTUzS0lLVSIsCiAgICAgICAgInR5cGUiOiAidGV4dCIsCiAgICAgICAgImNvbnRlbnQiOiAiVGhlIERlcGFydG1lbnQgb2YgRW5lcmd5IHJlZmVycmVkIHF1ZXN0aW9ucyBhYm91dCB0aGUgaW52ZXN0aWdhdGlvbiwgd2hpY2ggcmVtYWlucyBvcGVuLCB0byBpdHMgSW5zcGVjdG9yIEdlbmVyYWzigJlzIG9mZmljZSwgd2hpY2ggZGlkIG5vdCByZXNwb25kIHRvIGEgcmVxdWVzdCBmb3IgaW5mb3JtYXRpb24uIERIUyBhbHNvIGRpZCBub3QgcmVzcG9uZCB0byBxdWVzdGlvbnMgb3IgbWFrZSBCcnlhbiBhdmFpbGFibGUgZm9yIGFuIGludGVydmlldy4iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIk1FMkhTVkpGQlpGNE5IUzRVMlFGUlpCSUtBIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJCcnlhbiBwcmVzaWRlcyBvdmVyIGFuIG9yZ2FuaXphdGlvbiB0aGF0IGhhcyBoYWQgaXRzIGJ1ZGdldCBjdXQgYnkgdGhlIFRydW1wIGFkbWluaXN0cmF0aW9uLCBkZXNwaXRlIHRoZSBwcm9taW5lbnQgcm9sZSB0aGUgcHJlc2lkZW50IGdhdmUgaXQgZHVyaW5nIGhpcyBicmllZmluZyB0byBkaXNjdXNzIGhvdyB3b3JrIGRvbmUgYXQgYW4gYWdlbmN5IGxhYiBpbiBNYXJ5bGFuZCBzaG93ZWQgdGhlIHZpcnVzIGJyZWFraW5nIGRvd24gd2hlbiBleHBvc2VkIHRvIGxpZ2h0IGFuZCBodW1pZGl0eS4iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIjNPWUVURk82RVZERVZJNUJCTE9SWEM1VVJVIiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJVbmRlciB0aGUgZmluYWwgeWVhciBvZiBQcmVzaWRlbnQgQmFyYWNrIE9iYW1hLCB0aGUgYWdlbmN5IGhhZCBhIGJ1ZGdldCBvZiAkODQxIG1pbGxpb24sIG1vcmUgdGhhbiBoYWxmIG9mIHdoaWNoIHdhcyBmb3IgcmVzZWFyY2ggYW5kIGRldmVsb3BtZW50LiBUaGUgVHJ1bXAgYWRtaW5pc3RyYXRpb24gY3V0IHRoYXQgdG8gYXJvdW5kICQ1ODMgbWlsbGlvbiBpbiBpdHMgZmlyc3QgYnVkZ2V0IHRvIGZ1bmQgb3RoZXIgcHJpb3JpdGllcy4gSXQgcHJvcG9zZWQgcmVzdG9yaW5nIHNvbWUgb2YgdGhhdCB0aGlzIHllYXIgYW5kIHJhaXNpbmcgaXQgdG8gJDY0MyBtaWxsaW9uLiIKICAgICAgfSwKICAgICAgewogICAgICAgICJfaWQiOiAiU1JZVFFYMjdLTkNRTEs1Q1g0SU80SjNLSFUiLAogICAgICAgICJ0eXBlIjogInRleHQiLAogICAgICAgICJjb250ZW50IjogIl9fX18iCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiX2lkIjogIkZNRUxTN05aQ0pBMjNHWFVHRVFWR1hMWVE0IiwKICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAiY29udGVudCI6ICJBc3NvY2lhdGVkIFByZXNzIHdyaXRlciBFcmljIFR1Y2tlciBjb250cmlidXRlZCB0byB0aGlzIHJlcG9ydC4iCiAgICAgIH0KICAgIF0sCiAgICAiY3JlYXRlZF9kYXRlIjogIjIwMjAtMDQtMjRUMjI6Mjc6MzguODQyWiIsCiAgICAicmV2aXNpb24iOiB7CiAgICAgICJyZXZpc2lvbl9pZCI6ICI0MlpXWkJMTEZaREVMRDdTU1pOQ08zWVVWWSIsCiAgICAgICJwYXJlbnRfaWQiOiAiQ0pNRkIzQzRFUkdSUFBLT0JCSVFXSklWSlUiLAogICAgICAiZWRpdGlvbnMiOiBbCiAgICAgICAgImRlZmF1bHQiCiAgICAgIF0sCiAgICAgICJicmFuY2giOiAiZGVmYXVsdCIsCiAgICAgICJwdWJsaXNoZWQiOiB0cnVlCiAgICB9LAogICAgImxhc3RfdXBkYXRlZF9kYXRlIjogIjIwMjAtMDQtMjVUMDI6MDQ6MzYuODc2WiIsCiAgICAiY2Fub25pY2FsX3VybCI6ICIvc2Ivd29ybGQvYXJ0aWNsZS1zZW5pb3Itb2ZmaWNpYWwtY2l0ZWQtYnktdHJ1bXAtaXMtc3ViamVjdC1vZi1pbnZlc3RpZ2F0aW9uLyIsCiAgICAiaGVhZGxpbmVzIjogewogICAgICAiYmFzaWMiOiAiU2VuaW9yIG9mZmljaWFsIGNpdGVkIGJ5IFRydW1wIGlzIHN1YmplY3Qgb2YgaW52ZXN0aWdhdGlvbiIKICAgIH0sCiAgICAib3duZXIiOiB7CiAgICAgICJuYW1lIjogIldpcmUgU2VydmljZSIsCiAgICAgICJzcG9uc29yZWQiOiBmYWxzZSwKICAgICAgImlkIjogInNhbmRib3gudGdhbSIKICAgIH0sCiAgICAiY29udGVudF9yZXN0cmljdGlvbnMiOiB7CiAgICAgICJjb250ZW50X2NvZGUiOiAieWVsbG93IgogICAgfSwKICAgICJjb21tZW50cyI6IHsKICAgICAgImRpc3BsYXlfY29tbWVudHMiOiB0cnVlCiAgICB9LAogICAgInN5bmRpY2F0aW9uIjogewogICAgICAiZXh0ZXJuYWxfZGlzdHJpYnV0aW9uIjogdHJ1ZSwKICAgICAgInNlYXJjaCI6IHRydWUKICAgIH0sCiAgICAid29ya2Zsb3ciOiB7CiAgICAgICJzdGF0dXNfY29kZSI6IDUKICAgIH0sCiAgICAic3ViaGVhZGxpbmVzIjogewogICAgICAiYmFzaWMiOiAiU2VuaW9yIG9mZmljaWFsIGNpdGVkIGJ5IFRydW1wIGlzIHN1YmplY3Qgb2YgaW52ZXN0aWdhdGlvbiIKICAgIH0sCiAgICAidGF4b25vbXkiOiB7CiAgICAgICJzaXRlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogIi93b3JsZCIsCiAgICAgICAgICAidHlwZSI6ICJzaXRlIiwKICAgICAgICAgICJ2ZXJzaW9uIjogIjAuNS44IiwKICAgICAgICAgICJuYW1lIjogIldvcmxkIiwKICAgICAgICAgICJwYXRoIjogIi93b3JsZCIsCiAgICAgICAgICAicGFyZW50X2lkIjogIi8iLAogICAgICAgICAgImFkZGl0aW9uYWxfcHJvcGVydGllcyI6IHsKICAgICAgICAgICAgIm9yaWdpbmFsIjogewogICAgICAgICAgICAgICJfaWQiOiAiL3dvcmxkIiwKICAgICAgICAgICAgICAibmF2aWdhdGlvbiI6IHsKICAgICAgICAgICAgICAgICJuYXZfdGl0bGUiOiAiV29ybGQiLAogICAgICAgICAgICAgICAgIm5hdl9kaXNwbGF5IjogInRydWUiLAogICAgICAgICAgICAgICAgIm5hdl91cmwiOiAiL3dvcmxkIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgIl9hZG1pbiI6IHsKICAgICAgICAgICAgICAgICJhbGlhc19pZHMiOiBbCiAgICAgICAgICAgICAgICAgICIvbmV3cy93b3JsZCIsCiAgICAgICAgICAgICAgICAgICIvd29ybGQiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAibWV0YWRhdGEiOiB7CiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiVGhlIEdsb2JlIGFuZCBNYWlsJ3Mgd29ybGQgY292ZXJhZ2UsIHByb3ZpZGluZyBpbmZvcm1hdGlvbiBhbmQgYW5hbHlzaXMgb2YgYnJlYWtpbmcgd29ybGQgbmV3cyBzdG9yaWVzLiBHZXQgdGhlIGxhdGVzdCBmb3JlaWduIG5ld3MgZmVhdHVyaW5nIGFuYWx5c2lzLCBnYWxsZXJpZXMgYW5kIHZpZGVvcy4iLAogICAgICAgICAgICAgICAgImtleXdvcmRzIjogIkdsb2JlIGFuZCBNYWlsIHdvcmxkIG5ld3Msd29ybGQgbmV3cyxpbnRlcm5hdGlvbmFsIG5ld3Msd29ybGQgcmVwb3J0LGdsb2JhbCBuZXdzLGJyZWFraW5nIHdvcmxkIG5ld3MsZm9yZWlnbiBuZXdzLGZvcmVpZ24gYnJlYWtpbmcgbmV3cyxjdXJyZW50IGZvcmVpZ24gbmV3cyx3b3JsZCBuZXdzIHZpZGVvIiwKICAgICAgICAgICAgICAgICJtZXRhX3RpdGxlIjogIldvcmxkIiwKICAgICAgICAgICAgICAgICJjb250ZW50X2NvZGUiOiAieWVsbG93IiwKICAgICAgICAgICAgICAgICJuZXdza2V5d29yZHMiOiAiR2xvYmUgYW5kIE1haWwgd29ybGQgbmV3cyx3b3JsZCBuZXdzLGludGVybmF0aW9uYWwgbmV3cyx3b3JsZCByZXBvcnQsZ2xvYmFsIG5ld3MsYnJlYWtpbmcgd29ybGQgbmV3cyxmb3JlaWduIG5ld3MsZm9yZWlnbiBicmVha2luZyBuZXdzLGN1cnJlbnQgZm9yZWlnbiBuZXdzLHdvcmxkIG5ld3MgdmlkZW8iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic29jaWFsIjogewogICAgICAgICAgICAgICAgImZhY2Vib29rX2FwcF9pZCI6ICIxMjYwNDU5MzQwNzYyMDAiLAogICAgICAgICAgICAgICAgInR3aXR0ZXJfYWNjb3VudCI6ICJnbG9iZWFuZG1haWwiLAogICAgICAgICAgICAgICAgInR3aXR0ZXJfYWNjb3VudF9pZCI6ICI4NzM2ODgyIiwKICAgICAgICAgICAgICAgICJ0d2l0dGVyX3N1Z2dlc3Rpb25zIjogW10KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzaXRlbWFwIjogewogICAgICAgICAgICAgICAgImluY2x1ZGVfaW5fc2l0ZW1hcCI6ICJmYWxzZSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJxdWVyaWVzIjogewogICAgICAgICAgICAgICAgImF1dG9tYXRlZCI6ICIodGF4b25vbXkuc2l0ZXMucGF0aCUzQSU1QyUyRndvcmxkJTIwT1IlMjB0YXhvbm9teS5zaXRlcy5yZWZlcmVudC5pZCUzQSU1QyUyRm5ld3MlNUMlMkZ3b3JsZCopIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgIm5hbWUiOiAiV29ybGQiLAogICAgICAgICAgICAgICJvcmRlciI6IDEwMTAsCiAgICAgICAgICAgICAgImluYWN0aXZlIjogZmFsc2UsCiAgICAgICAgICAgICAgInBhcmVudCI6ICIvIiwKICAgICAgICAgICAgICAiYW5jZXN0b3JzIjogWwogICAgICAgICAgICAgICAgIi8iCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAic2l0ZSI6IHsKICAgICAgICAgICAgICAgICJwYWdlYnVpbGRlcl9wYXRoX2Zvcl9uYXRpdmVfYXBwcyI6ICIvd29ybGQvIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgIm5vZGVfdHlwZSI6ICJzZWN0aW9uIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgInByaW1hcnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdLAogICAgICAicHJpbWFyeV9zaXRlIjogewogICAgICAgICJfaWQiOiAiL3dvcmxkIiwKICAgICAgICAidHlwZSI6ICJzaXRlIiwKICAgICAgICAidmVyc2lvbiI6ICIwLjUuOCIsCiAgICAgICAgIm5hbWUiOiAiV29ybGQiLAogICAgICAgICJwYXRoIjogIi93b3JsZCIsCiAgICAgICAgInBhcmVudF9pZCI6ICIvIiwKICAgICAgICAiYWRkaXRpb25hbF9wcm9wZXJ0aWVzIjogewogICAgICAgICAgIm9yaWdpbmFsIjogewogICAgICAgICAgICAiX2lkIjogIi93b3JsZCIsCiAgICAgICAgICAgICJuYXZpZ2F0aW9uIjogewogICAgICAgICAgICAgICJuYXZfdGl0bGUiOiAiV29ybGQiLAogICAgICAgICAgICAgICJuYXZfZGlzcGxheSI6ICJ0cnVlIiwKICAgICAgICAgICAgICAibmF2X3VybCI6ICIvd29ybGQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJfYWRtaW4iOiB7CiAgICAgICAgICAgICAgImFsaWFzX2lkcyI6IFsKICAgICAgICAgICAgICAgICIvbmV3cy93b3JsZCIsCiAgICAgICAgICAgICAgICAiL3dvcmxkIgogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm1ldGFkYXRhIjogewogICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgR2xvYmUgYW5kIE1haWwncyB3b3JsZCBjb3ZlcmFnZSwgcHJvdmlkaW5nIGluZm9ybWF0aW9uIGFuZCBhbmFseXNpcyBvZiBicmVha2luZyB3b3JsZCBuZXdzIHN0b3JpZXMuIEdldCB0aGUgbGF0ZXN0IGZvcmVpZ24gbmV3cyBmZWF0dXJpbmcgYW5hbHlzaXMsIGdhbGxlcmllcyBhbmQgdmlkZW9zLiIsCiAgICAgICAgICAgICAgImtleXdvcmRzIjogIkdsb2JlIGFuZCBNYWlsIHdvcmxkIG5ld3Msd29ybGQgbmV3cyxpbnRlcm5hdGlvbmFsIG5ld3Msd29ybGQgcmVwb3J0LGdsb2JhbCBuZXdzLGJyZWFraW5nIHdvcmxkIG5ld3MsZm9yZWlnbiBuZXdzLGZvcmVpZ24gYnJlYWtpbmcgbmV3cyxjdXJyZW50IGZvcmVpZ24gbmV3cyx3b3JsZCBuZXdzIHZpZGVvIiwKICAgICAgICAgICAgICAibWV0YV90aXRsZSI6ICJXb3JsZCIsCiAgICAgICAgICAgICAgImNvbnRlbnRfY29kZSI6ICJ5ZWxsb3ciLAogICAgICAgICAgICAgICJuZXdza2V5d29yZHMiOiAiR2xvYmUgYW5kIE1haWwgd29ybGQgbmV3cyx3b3JsZCBuZXdzLGludGVybmF0aW9uYWwgbmV3cyx3b3JsZCByZXBvcnQsZ2xvYmFsIG5ld3MsYnJlYWtpbmcgd29ybGQgbmV3cyxmb3JlaWduIG5ld3MsZm9yZWlnbiBicmVha2luZyBuZXdzLGN1cnJlbnQgZm9yZWlnbiBuZXdzLHdvcmxkIG5ld3MgdmlkZW8iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzb2NpYWwiOiB7CiAgICAgICAgICAgICAgImZhY2Vib29rX2FwcF9pZCI6ICIxMjYwNDU5MzQwNzYyMDAiLAogICAgICAgICAgICAgICJ0d2l0dGVyX2FjY291bnQiOiAiZ2xvYmVhbmRtYWlsIiwKICAgICAgICAgICAgICAidHdpdHRlcl9hY2NvdW50X2lkIjogIjg3MzY4ODIiLAogICAgICAgICAgICAgICJ0d2l0dGVyX3N1Z2dlc3Rpb25zIjogW10KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInNpdGVtYXAiOiB7CiAgICAgICAgICAgICAgImluY2x1ZGVfaW5fc2l0ZW1hcCI6ICJmYWxzZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInF1ZXJpZXMiOiB7CiAgICAgICAgICAgICAgImF1dG9tYXRlZCI6ICIodGF4b25vbXkuc2l0ZXMucGF0aCUzQSU1QyUyRndvcmxkJTIwT1IlMjB0YXhvbm9teS5zaXRlcy5yZWZlcmVudC5pZCUzQSU1QyUyRm5ld3MlNUMlMkZ3b3JsZCopIgogICAgICAgICAgICB9LAogICAgICAgICAgICAibmFtZSI6ICJXb3JsZCIsCiAgICAgICAgICAgICJvcmRlciI6IDEwMTAsCiAgICAgICAgICAgICJpbmFjdGl2ZSI6IGZhbHNlLAogICAgICAgICAgICAicGFyZW50IjogIi8iLAogICAgICAgICAgICAiYW5jZXN0b3JzIjogWwogICAgICAgICAgICAgICIvIgogICAgICAgICAgICBdLAogICAgICAgICAgICAic2l0ZSI6IHsKICAgICAgICAgICAgICAicGFnZWJ1aWxkZXJfcGF0aF9mb3JfbmF0aXZlX2FwcHMiOiAiL3dvcmxkLyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIm5vZGVfdHlwZSI6ICJzZWN0aW9uIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInByaW1hcnkiOiB0cnVlCiAgICAgIH0sCiAgICAgICJzZW9fa2V5d29yZHMiOiBbCiAgICAgICAgIkludGVybmF0aW9uYWwiLAogICAgICAgICJQb2xpdGljcyIKICAgICAgXSwKICAgICAgImtleXdvcmRzIjogWwogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImJyeWFuIiwKICAgICAgICAgICJzY29yZSI6IDAuNDc5MTcyODAzNDg4Nzk2NiwKICAgICAgICAgICJ0YWciOiAicHJvcGVyX25vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDI0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJtYW5hZm9ydCIsCiAgICAgICAgICAic2NvcmUiOiAwLjQxODEwOTA1MzM1NjI2ODcsCiAgICAgICAgICAidGFnIjogInByb3Blcl9ub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJkZXBhcnRtZW50IiwKICAgICAgICAgICJzY29yZSI6IDAuMjI2OTYxNjM0OTQ0MDQ0OCwKICAgICAgICAgICJ0YWciOiAicHJvcGVyX25vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDExCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJlbmVyZ3kiLAogICAgICAgICAgInNjb3JlIjogMC4yMTk4NTA5MzY3NTc3MTM3LAogICAgICAgICAgInRhZyI6ICJwcm9wZXJfbm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogMTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogInVrcmFpbmUiLAogICAgICAgICAgInNjb3JlIjogMC4yMTY2MzkyNzE0MTAyMjA4MiwKICAgICAgICAgICJ0YWciOiAicHJvcGVyX25vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImludmVzdGlnYXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4yMTA0NTE5MjIxMjc1NzI2NiwKICAgICAgICAgICJ0YWciOiAibm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogIm9mZmljZSIsCiAgICAgICAgICAic2NvcmUiOiAwLjE4ODI0Mzg4MzMxOTQ3MTk4LAogICAgICAgICAgInRhZyI6ICJwcm9wZXJfbm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImtleXdvcmQiOiAidHJ1bXAiLAogICAgICAgICAgInNjb3JlIjogMC4xODc5MjU2ODQ5MzgxNTExNSwKICAgICAgICAgICJ0YWciOiAicHJvcGVyX25vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDEyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJidWRnZXQiLAogICAgICAgICAgInNjb3JlIjogMC4xNjU3NTI0NjYxMDUxOTc0NSwKICAgICAgICAgICJ0YWciOiAibm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImtleXdvcmQiOiAid29yayIsCiAgICAgICAgICAic2NvcmUiOiAwLjE0MjY1ODM4MjM2MzI2NzcsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImluZm9ybWF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMTM5Mzc0NTQ2NDY3OTQzNDUsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImNvbXBsYWludCIsCiAgICAgICAgICAic2NvcmUiOiAwLjEzNjUyNTQwNTE3NzU1NzEsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogInByZXNpZGVudCIsCiAgICAgICAgICAic2NvcmUiOiAwLjEzMjAzMzQxNTc5ODA4Mjg0LAogICAgICAgICAgInRhZyI6ICJub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJ3aGlzdGxlLWJsb3dlciIsCiAgICAgICAgICAic2NvcmUiOiAwLjEyNTIxMTQ5NDI4NTUyODA4LAogICAgICAgICAgInRhZyI6ICJub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJCcnlhbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjExNDc2NDkyMTQ0MDQzNjQ0LAogICAgICAgICAgInRhZyI6ICJwcm9wZXJfbm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogMTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImxldHRlciIsCiAgICAgICAgICAic2NvcmUiOiAwLjEwOTgwMjcyNDE4Mzk3Mzc2LAogICAgICAgICAgInRhZyI6ICJub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJjb3Vuc2VsIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgyNjUwMDE1MjUyNDU1MTUsCiAgICAgICAgICAidGFnIjogInByb3Blcl9ub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJhZ2VuY3kiLAogICAgICAgICAgInNjb3JlIjogMC4wNzc5Mzk3MDA1NDk0NjU2OCwKICAgICAgICAgICJ0YWciOiAibm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImtleXdvcmQiOiAicmVzZWFyY2giLAogICAgICAgICAgInNjb3JlIjogMC4wNzcyNTAyODE4OTUxODE5NywKICAgICAgICAgICJ0YWciOiAibm91biIsCiAgICAgICAgICAiZnJlcXVlbmN5IjogNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgImtleXdvcmQiOiAiTWFuYWZvcnQiLAogICAgICAgICAgInNjb3JlIjogMC4wNzY3OTU1NDA0MTIzNzU4NywKICAgICAgICAgICJ0YWciOiAicHJvcGVyX25vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogInVuZGVyc2VjcmV0YXJ5IiwKICAgICAgICAgICJzY29yZSI6IDAuMDc2NjUzMzI2NDQ4NjQ5MjYsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogImF0dG9ybmV5IiwKICAgICAgICAgICJzY29yZSI6IDAuMDc2NjAxNzU0MzUxOTEzMjEsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJrZXl3b3JkIjogIml2eSIsCiAgICAgICAgICAic2NvcmUiOiAwLjA3NTkwNjQ4NjA4NDgwNTMsCiAgICAgICAgICAidGFnIjogInByb3Blcl9ub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJ2aXJ1cyIsCiAgICAgICAgICAic2NvcmUiOiAwLjA3NDk1ODYxMDA0NzU3MzY2LAogICAgICAgICAgInRhZyI6ICJub3VuIiwKICAgICAgICAgICJmcmVxdWVuY3kiOiA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAia2V5d29yZCI6ICJ3cm9uZ2RvaW5nIiwKICAgICAgICAgICJzY29yZSI6IDAuMDcxMDY2MzQ5MzAyMjQ2MjQsCiAgICAgICAgICAidGFnIjogIm5vdW4iLAogICAgICAgICAgImZyZXF1ZW5jeSI6IDQKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJ0b3BpY3MiOiBbCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICI1MzRkYjdhMmU0YjBiZTRmNWMzOGU3Y2QiLAogICAgICAgICAgIm5hbWUiOiAiRGVmZW5zZSBhbmQgQ3liZXJzZWN1cml0eSIsCiAgICAgICAgICAic2NvcmUiOiAwLjU4NTA3ODg4NzU0NTgwNjMsCiAgICAgICAgICAidWlkIjogInZuIgogICAgICAgIH0KICAgICAgXSwKICAgICAgImF1eGlsaWFyaWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiNTg3N2JlZmRjOWU3N2MwMDAxYTlhMTZlIiwKICAgICAgICAgICJuYW1lIjogIkNvbmdyZXNzaW9uYWwgQnVkZ2V0IiwKICAgICAgICAgICJ1aWQiOiAiNVpWIgogICAgICAgIH0KICAgICAgXSwKICAgICAgIm5hbWVkX2VudGl0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiYnJ5YW4iLAogICAgICAgICAgIm5hbWUiOiAiQnJ5YW4iLAogICAgICAgICAgInR5cGUiOiAicGVyc29uIiwKICAgICAgICAgICJzY29yZSI6IDAuMzYwMTU5NzIyNTM5NDczNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJyaW5hdC1ha2htZXRvdiIsCiAgICAgICAgICAibmFtZSI6ICJSaW5hdCBBa2htZXRvdiIsCiAgICAgICAgICAidHlwZSI6ICJwZXJzb24iLAogICAgICAgICAgInNjb3JlIjogMC4zNTMwMzM4OTc4MDkyMTA2MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJkb2UiLAogICAgICAgICAgIm5hbWUiOiAiRE9FIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjMwODE4ODYwMDQxNDU5NjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiZGVwYXJ0bWVudC1vZi1lbmVyZ3kiLAogICAgICAgICAgIm5hbWUiOiAiRGVwYXJ0bWVudCBvZiBFbmVyZ3kiLAogICAgICAgICAgInR5cGUiOiAib3JnYW5pemF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMjcxNDQ4MjUxMDYzODI1OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJoaWxsIiwKICAgICAgICAgICJuYW1lIjogIkhpbGwiLAogICAgICAgICAgInR5cGUiOiAib3JnYW5pemF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMjY2NjM0MDQyODczMjM3NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJlbmVyZ3ktZGVwYXJ0bWVudCIsCiAgICAgICAgICAibmFtZSI6ICJFbmVyZ3kgRGVwYXJ0bWVudCIsCiAgICAgICAgICAidHlwZSI6ICJvcmdhbml6YXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4yMzg4NTAxOTQ1OTM4MDczMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJlcmljLXR1Y2tlciIsCiAgICAgICAgICAibmFtZSI6ICJFcmljIFR1Y2tlciIsCiAgICAgICAgICAidHlwZSI6ICJwZXJzb24iLAogICAgICAgICAgInNjb3JlIjogMC4yMzgzNDAzNTU1MDEzNjc4NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJkaHMiLAogICAgICAgICAgIm5hbWUiOiAiREhTIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjIxMDI4OTcyNzgyMDc5NDY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImRlcGFydG1lbnQtb2YtaG9tZWxhbmQtc2VjdXJpdHkiLAogICAgICAgICAgIm5hbWUiOiAiRGVwYXJ0bWVudCBvZiBIb21lbGFuZCBTZWN1cml0eSIsCiAgICAgICAgICAidHlwZSI6ICJvcmdhbml6YXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4xODMxODM2MjAwMTY4ODAzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJzb3ZpZXQtdW5pb24iLAogICAgICAgICAgIm5hbWUiOiAiU292aWV0IFVuaW9uIiwKICAgICAgICAgICJ0eXBlIjogImxvY2F0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMTgwNDM3ODcyNjMzNzk4NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAicGF1bC1tYW5hZm9ydCIsCiAgICAgICAgICAibmFtZSI6ICJQYXVsIE1hbmFmb3J0IiwKICAgICAgICAgICJ0eXBlIjogInBlcnNvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjE3ODQ0Nzc5Njg2NDA1NDg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogInJvYmVydC1tdWVsbGVyIiwKICAgICAgICAgICJuYW1lIjogIlJvYmVydCBNdWVsbGVyIiwKICAgICAgICAgICJ0eXBlIjogInBlcnNvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjE3MTg4MTExOTg0Mjc0MDkzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogInVrcmFpbmUiLAogICAgICAgICAgIm5hbWUiOiAiVWtyYWluZSIsCiAgICAgICAgICAidHlwZSI6ICJsb2NhdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjE2NjA5Nzc3ODEyODk1NTMyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImFwIiwKICAgICAgICAgICJuYW1lIjogIkFQIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjEyODIxMDI3MjExMzY1NjU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogIm5ldy15b3JrLXRpbWVzIiwKICAgICAgICAgICJuYW1lIjogIk5ldyBZb3JrIFRpbWVzIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjEyNDY4MjMwOTk4MTcyNTM0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImJhcmFjay1vYmFtYSIsCiAgICAgICAgICAibmFtZSI6ICJCYXJhY2sgT2JhbWEiLAogICAgICAgICAgInR5cGUiOiAicGVyc29uIiwKICAgICAgICAgICJzY29yZSI6IDAuMTE4MDg3NTMwMTQ4ODQwNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAibWFyeWxhbmQiLAogICAgICAgICAgIm5hbWUiOiAiTWFyeWxhbmQiLAogICAgICAgICAgInR5cGUiOiAibG9jYXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4xMTI0NjA3MzM0ODkyNjIzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJ2aXJnaW5pYSIsCiAgICAgICAgICAibmFtZSI6ICJWaXJnaW5pYSIsCiAgICAgICAgICAidHlwZSI6ICJsb2NhdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjEwODA0NTIxNTE3MDk0NDYzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogInJ1c3NpYSIsCiAgICAgICAgICAibmFtZSI6ICJSdXNzaWEiLAogICAgICAgICAgInR5cGUiOiAibG9jYXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4wOTU3NDM1NjQxMjQ4OTQ0NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJzZW5hdGUiLAogICAgICAgICAgIm5hbWUiOiAiU2VuYXRlIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjA5NTU4NTE3MTUxNjMzMjQzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImNvbmdyZXNzIiwKICAgICAgICAgICJuYW1lIjogIkNvbmdyZXNzIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjA4OTExMzY3NjczODA4NjE5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImRvbmFsZC10cnVtcCIsCiAgICAgICAgICAibmFtZSI6ICJEb25hbGQgVHJ1bXAiLAogICAgICAgICAgInR5cGUiOiAicGVyc29uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgzOTk3MjI1ODc3MTM3OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAib2ZmaWNlLW9mLXRoZS1zcGVjaWFsLWNvdW5zZWwiLAogICAgICAgICAgIm5hbWUiOiAiT2ZmaWNlIG9mIHRoZSBTcGVjaWFsIENvdW5zZWwiLAogICAgICAgICAgInR5cGUiOiAib3JnYW5pemF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAia3lpdiIsCiAgICAgICAgICAibmFtZSI6ICJLeWl2IiwKICAgICAgICAgICJ0eXBlIjogImxvY2F0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiYWhrbWV0b3YiLAogICAgICAgICAgIm5hbWUiOiAiQWhrbWV0b3YiLAogICAgICAgICAgInR5cGUiOiAicGVyc29uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAid2lsbGlhbS1icnlhbiIsCiAgICAgICAgICAibmFtZSI6ICJXaWxsaWFtIEJyeWFuIiwKICAgICAgICAgICJ0eXBlIjogInBlcnNvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjA4MTU4Nzk3MTAwNzUyNDgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImh5YXR0LWhvdGVsIiwKICAgICAgICAgICJuYW1lIjogIkh5YXR0IEhvdGVsIiwKICAgICAgICAgICJ0eXBlIjogImxvY2F0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiam9obi10eWUiLAogICAgICAgICAgIm5hbWUiOiAiSm9obiBUeWUiLAogICAgICAgICAgInR5cGUiOiAicGVyc29uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiZGVwYXJ0bWVudC1vZi1lbmVyZ3ktb2ZmaWNlLW9mLWluc3BlY3Rvci1nZW5lcmFsIiwKICAgICAgICAgICJuYW1lIjogIkRlcGFydG1lbnQgb2YgRW5lcmd5IE9mZmljZSBvZiBJbnNwZWN0b3IgR2VuZXJhbCIsCiAgICAgICAgICAidHlwZSI6ICJvcmdhbml6YXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4wODE1ODc5NzEwMDc1MjQ4MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJvZmZpY2Utb2YtaW50ZXJuYXRpb25hbC1hZmZhaXJzIiwKICAgICAgICAgICJuYW1lIjogIk9mZmljZSBvZiBJbnRlcm5hdGlvbmFsIEFmZmFpcnMiLAogICAgICAgICAgInR5cGUiOiAib3JnYW5pemF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiZGhzLXNjaWVuY2UtYW5kLXRlY2hub2xvZ3ktZGlyZWN0b3JhdGUiLAogICAgICAgICAgIm5hbWUiOiAiREhTIFNjaWVuY2UgYW5kIFRlY2hub2xvZ3kgRGlyZWN0b3JhdGUiLAogICAgICAgICAgInR5cGUiOiAib3JnYW5pemF0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDgxNTg3OTcxMDA3NTI0ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAiYmlsbC1icnlhbiIsCiAgICAgICAgICAibmFtZSI6ICJCaWxsIEJyeWFuIiwKICAgICAgICAgICJ0eXBlIjogInBlcnNvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjA4MTU4Nzk3MTAwNzUyNDgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogInJvYmVydC1pdnkiLAogICAgICAgICAgIm5hbWUiOiAiUm9iZXJ0IEl2eSIsCiAgICAgICAgICAidHlwZSI6ICJwZXJzb24iLAogICAgICAgICAgInNjb3JlIjogMC4wODE1ODc5NzEwMDc1MjQ4MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIl9pZCI6ICJ2YWx1ZWJyaWRnZS1pbnRlcm5hdGlvbmFsLXMtZW5lcmd5LWdyb3VwIiwKICAgICAgICAgICJuYW1lIjogIlZhbHVlQnJpZGdlIEludGVybmF0aW9uYWwgJ3MgRW5lcmd5IEdyb3VwIiwKICAgICAgICAgICJ0eXBlIjogIm9yZ2FuaXphdGlvbiIsCiAgICAgICAgICAic2NvcmUiOiAwLjA4MTU4Nzk3MTAwNzUyNDgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImRvbmFsZC10cnVtcCIsCiAgICAgICAgICAibmFtZSI6ICJUcnVtcCIsCiAgICAgICAgICAidHlwZSI6ICJvcmdhbml6YXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4wNzc3MzY0OTEzODA3ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJfaWQiOiAidS1zLSIsCiAgICAgICAgICAibmFtZSI6ICJVLlMuIiwKICAgICAgICAgICJ0eXBlIjogImxvY2F0aW9uIiwKICAgICAgICAgICJzY29yZSI6IDAuMDUzNDgzNTc4MzcxMzY0MzI1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiX2lkIjogImFzc29jaWF0ZWQtcHJlc3MiLAogICAgICAgICAgIm5hbWUiOiAiQXNzb2NpYXRlZCBQcmVzcyIsCiAgICAgICAgICAidHlwZSI6ICJvcmdhbml6YXRpb24iLAogICAgICAgICAgInNjb3JlIjogMC4wMTk4ODAxODgwNDE1Njc2MTcKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICAic291cmNlIjogewogICAgICAic3lzdGVtIjogImFyYyBpL28iLAogICAgICAic291cmNlX3R5cGUiOiAid2lyZXMiLAogICAgICAic291cmNlX2lkIjogIjJlM2I2YTIwZmQxOGNkM2VmNjZkYjA3YWEzNzBlNzE5IiwKICAgICAgIm5hbWUiOiAiVGhlIEFzc29jaWF0ZWQgUHJlc3MiCiAgICB9LAogICAgInByb21vX2l0ZW1zIjogewogICAgICAiYmFzaWMiOiB7CiAgICAgICAgIl9pZCI6ICJBWFk3WklRSzJKSlhMRjY1Q1BOUEZWTktOVSIsCiAgICAgICAgImFkZGl0aW9uYWxfcHJvcGVydGllcyI6IHsKICAgICAgICAgICJzb3VyY2VfdXJsIjogIkRDQUIzMjMtNDIzXzIwMjBfMjIwODI5LmpwZyIKICAgICAgICB9LAogICAgICAgICJjYXB0aW9uIjogIkJpbGwgQnJ5YW4sIGhlYWQgb2Ygc2NpZW5jZSBhbmQgdGVjaG5vbG9neSBhdCB0aGUgRGVwYXJ0bWVudCBvZiBIb21lbGFuZCBTZWN1cml0eSwgc3BlYWtzIGFib3V0IHRoZSBjb3JvbmF2aXJ1cyBpbiB0aGUgSmFtZXMgQnJhZHkgUHJlc3MgQnJpZWZpbmcgUm9vbSBvZiB0aGUgV2hpdGUgSG91c2UsIFRodXJzZGF5LCBBcHJpbCAyMywgMjAyMCwgaW4gV2FzaGluZ3Rvbi4gKEFQIFBob3RvL0FsZXggQnJhbmRvbikiLAogICAgICAgICJoZWlnaHQiOiA4NTMsCiAgICAgICAgInR5cGUiOiAiaW1hZ2UiLAogICAgICAgICJ1cmwiOiAiaHR0cHM6Ly9jbG91ZGZyb250LXVzLWVhc3QtMS5pbWFnZXMuYXJjcHVibGlzaGluZy5jb20vc2FuZGJveC50Z2FtL0FYWTdaSVFLMkpKWExGNjVDUE5QRlZOS05VLmpwZyIsCiAgICAgICAgInZlcnNpb24iOiAiMC4xMC41IiwKICAgICAgICAid2lkdGgiOiAxMjgwLAogICAgICAgICJjcmVkaXRzIjoge30sCiAgICAgICAgInNvdXJjZSI6IHsKICAgICAgICAgICJuYW1lIjogIlRoZSBBc3NvY2lhdGVkIFByZXNzIiwKICAgICAgICAgICJzb3VyY2VfaWQiOiAiY3Bfbml0Zi9Xb3JsZC9EQ0FCMzIzLTQyM18yMDIwXzIyMDgyOS5qcGciLAogICAgICAgICAgInNvdXJjZV90eXBlIjogIldpcmUiLAogICAgICAgICAgImFkZGl0aW9uYWxfcHJvcGVydGllcyI6IHsKICAgICAgICAgICAgImVkaXRvciI6ICJwaG90byBjZW50ZXIiCiAgICAgICAgICB9LAogICAgICAgICAgInN5c3RlbSI6ICJhcmMgaS9vIgogICAgICAgIH0sCiAgICAgICAgImRpc3RyaWJ1dG9yIjogewogICAgICAgICAgInJlZmVyZW5jZV9pZCI6ICI5Y2E1OTY3MS1iZjE2LTRjYmQtODZmMC04MTNmYjYwYWJiMjQiLAogICAgICAgICAgIm1vZGUiOiAicmVmZXJlbmNlIgogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJkaXN0cmlidXRvciI6IHsKICAgICAgInJlZmVyZW5jZV9pZCI6ICI5Y2E1OTY3MS1iZjE2LTRjYmQtODZmMC04MTNmYjYwYWJiMjQiLAogICAgICAibW9kZSI6ICJyZWZlcmVuY2UiCiAgICB9LAogICAgInRyYWNraW5nIjogewogICAgICAiaW5fdXJsX2hlYWRsaW5lIjogImFydGljbGUtc2VuaW9yLW9mZmljaWFsLWNpdGVkLWJ5LXRydW1wLWlzLXN1YmplY3Qtb2YtaW52ZXN0aWdhdGlvbiIKICAgIH0sCiAgICAicGxhbm5pbmciOiB7CiAgICAgICJpbnRlcm5hbF9ub3RlIjogIkJFR0lOIENQIE5PVEUgLS0tLS0gVVMtVmlydXMtT3V0YnJlYWstREhTLUJyeWFuIC0tIDIwMjAwNDI0VDIyMDI1Ni0wNDAwIFVQREFURVM6IEFkZHMgbmV3IHF1b3RlIGZyb20gY29tcGxhaW50IGluIDEydGggcGFyYWdyYXBoIGJlZ2lubmluZywgZG91YmxlIHF1b3RhdGlvbiBtYXJrSXQgc2F5cyBCcnlhbi4uLmRvdWJsZSBxdW90YXRpb24gbWFya2RvdWJsZSBxdW90YXRpb24gbWFyayBXaXRoIEFQIFBob3Rvcy4gLS0tLS0tIEVORCBDUCBOT1RFIC8vLyAiLAogICAgICAic2NoZWR1bGluZyI6IHsKICAgICAgICAicGxhbm5lZF9wdWJsaXNoX2RhdGUiOiAiMjAyMC0wNC0yNVQwMjowNDozNloiCiAgICAgIH0KICAgIH0sCiAgICAiZGlzcGxheV9kYXRlIjogIjIwMjAtMDQtMjRUMjI6Mjc6MzguODc5WiIsCiAgICAiY3JlZGl0cyI6IHsKICAgICAgImJ5IjogWwogICAgICAgIHsKICAgICAgICAgICJ0eXBlIjogImF1dGhvciIsCiAgICAgICAgICAibmFtZSI6ICJCZW4gRm94IiwKICAgICAgICAgICJvcmciOiAiVGhlIEFzc29jaWF0ZWQgUHJlc3MiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgInN1YnR5cGUiOiAid2lyZSIsCiAgICAiZmlyc3RfcHVibGlzaF9kYXRlIjogIjIwMjAtMDQtMjRUMjI6Mjc6MzguODc5WiIsCiAgICAibG9jYXRpb24iOiAiV2FzaGluZ3RvbiwgRGlzdHJpY3Qgb2YgQ29sdW1iaWEsIFVuaXRlZCBTdGF0ZXMiLAogICAgImFkZGl0aW9uYWxfcHJvcGVydGllcyI6IHsKICAgICAgIndvcmRfY291bnQiOiA3ODgsCiAgICAgICJmaWxlX25hbWUiOiAiY3Bfbml0Zi9Xb3JsZC9wMjU4NjcueG1sIiwKICAgICAgImhhc19wdWJsaXNoZWRfY29weSI6IHRydWUKICAgIH0sCiAgICAicHVibGlzaF9kYXRlIjogIjIwMjAtMDQtMjVUMDI6MDQ6MzYuODk4WiIsCiAgICAic2x1ZyI6ICIiLAogICAgInB1Ymxpc2hpbmciOiB7CiAgICAgICJzY2hlZHVsZWRfb3BlcmF0aW9ucyI6IHsKICAgICAgICAicHVibGlzaF9lZGl0aW9uIjogW10sCiAgICAgICAgInVucHVibGlzaF9lZGl0aW9uIjogWwogICAgICAgICAgewogICAgICAgICAgICAib3BlcmF0aW9uX2RhdGUiOiAiMjAyMC0wNy0yNFQwMjowNDozNi4wMDBaIiwKICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJ1bnB1Ymxpc2hfZWRpdGlvbiIsCiAgICAgICAgICAgICJ0eXBlIjogInN0b3J5X29wZXJhdGlvbiIKICAgICAgICAgIH0KICAgICAgICBdCiAgICAgIH0KICAgIH0sCiAgICAiX2lkIjogIldSTEpVVlI1VkZQRFpLUFFaUE9YS1JZQzRZIgogIH0KfQ==",
                "partitionKey": "dbb36154-59a7-493d-a638-561578ab5b23",
                "encryptionType": "NONE"
            }
        }
    ]
}
```
click on create and then once created click on the **Test Button** to test the lambda.

Expected Log Output - 

`START RequestId: cc014b97-edb3-4c06-b764-46d2311163a8 Version: $LATEST
ArcFilterFunction - INFO - Total events received: 1
ArcFilterFunction - INFO - Decoded event with eventId shardId-000000000000:49609560339806358283862413364490677014111167574043525122
ArcFilterFunction - INFO - Transforming the decoded event with partitionKey dbb36154-59a7-493d-a638-561578ab5b23 to json
ArcFilterFunction - INFO - Successful processed 1 records , Transformed=0, errors=0, skipped=1
END RequestId: cc014b97-edb3-4c06-b764-46d2311163a8
REPORT RequestId: cc014b97-edb3-4c06-b764-46d2311163a8	Duration: 126.69 ms	Billed Duration: 200 ms	Memory Size: 512 MB	Max Memory Used: 69 MB	Init Duration: 519.23 ms	`

## Env Variables

### KINESIS_ENDPOINT_URL
kinesis endpoint when testing locally it will be local-stack docker ip which can be find from running command
- `docker container inspect localstack_main`
else by default aws kinesis account ip address, e.g https://kinesis.us-east-1.amazonaws.com

### AWS_ACCESS_KEY_ID
kinesis aws access key or value as "iam" when using iam user 

### AWS_SECRET_ACCESS_KEY
kinesis aws secret access key or value as "iam" when using iam user

### AWS_REGION
aws kinesis account region, e.g "us-east-1"

### TO_FILTER_PARAMETERS
comma(',') separated list of parameters that needs to be omitted from input stream, e.g "operation, body.credits.by"
or by default its empty "" 

### OUTPUT_STREAM
output stream name where filtered events will be stored 

### LOG_LEVEL
logging level for the application by default INFO

## run test cases
`python3 -m unittest tests.arcfeed_cms_filtertest`

## testing locally
1) Start the local-stack
```
docker-compose up
```

2) Setup the dev env
```
sudo python3 -m venv dev_env
source dev_env/bin/activate
```

3) Install Chalice on local (if not present) 
``sudo pip install chalice``

4) Create a deployment package
```edit .chalice/config.json with required env variables```

``chalice package .``

5)Create the lambda function
```
awslocal lambda create-function --function-name ArcFilterFunction --runtime python3.8 --role admin --handler app.execute --zip-file fileb://deployment.zip

awslocal lambda create-event-source-mapping --function-name ArcFilterFunction \
--event-source  arn:aws:kinesis:us-east-1:000000000000:stream/develop_cmsfeed \
--batch-size 1 --starting-position LATEST

awslocal lambda update-function-configuration --function-name ArcFilterFunction \
--environment "Variables={TO_FILTER_PARAMETERS=operation, KINESIS_ENDPOINT_URL='http://172.21.0.2:4568', OUTPUT_STREAM=filtered_cmsfeed}"
```

if any code is changed - 
```
awslocal lambda update-function-code --function-name ArcFilterFunction --zip-file fileb://deployment.zip
```

6) To list 
```
awslocal lambda list-functions
awslocal kinesis list-streams
```

7) Insert one sample message in the input stream i.e develop_cmsfeed
`
awslocal kinesis put-record --stream-name develop_cmsfeed --data 'file://tests/resources/sample_arc_message.json'  --partition-key 'uuidgen'
`

Output - 
Filtered message should be inserted in the output stream i.e filtered_cmsfeed